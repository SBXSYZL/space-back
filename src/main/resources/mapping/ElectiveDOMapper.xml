<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.project.demo.dao.ElectiveDOMapper">
    <resultMap id="BaseResultMap" type="com.project.demo.DO.ElectiveDO">
        <id column="user_id" jdbcType="INTEGER" property="userId"/>
        <id column="course_id" jdbcType="INTEGER" property="courseId"/>
        <result column="exam_score" jdbcType="REAL" property="examScore"/>
        <result column="performance_score" jdbcType="REAL" property="performanceScore"/>
        <result column="work_score" jdbcType="REAL" property="workScore"/>
        <result column="completed" jdbcType="INTEGER" property="completed"/>
    </resultMap>
    <sql id="Base_Column_List">
    user_id, course_id, exam_score, performance_score, work_score, completed
  </sql>
    <select id="selectByPrimaryKey" parameterType="com.project.demo.DO.ElectiveDOKey" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from elective
        where user_id = #{userId,jdbcType=INTEGER}
        and course_id = #{courseId,jdbcType=INTEGER}
    </select>
    <delete id="deleteByPrimaryKey" parameterType="com.project.demo.DO.ElectiveDOKey">
    delete from elective
    where user_id = #{userId,jdbcType=INTEGER}
      and course_id = #{courseId,jdbcType=INTEGER}
  </delete>
    <insert id="insert" parameterType="com.project.demo.DO.ElectiveDO">
    insert into elective (user_id, course_id, exam_score, 
      performance_score, work_score, completed
      )
    values (#{userId,jdbcType=INTEGER}, #{courseId,jdbcType=INTEGER}, #{examScore,jdbcType=REAL}, 
      #{performanceScore,jdbcType=REAL}, #{workScore,jdbcType=REAL}, #{completed,jdbcType=INTEGER}
      )
  </insert>
    <insert id="insertSelective" parameterType="com.project.demo.DO.ElectiveDO">
        insert into elective
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="userId != null">
                user_id,
            </if>
            <if test="courseId != null">
                course_id,
            </if>
            <if test="examScore != null">
                exam_score,
            </if>
            <if test="performanceScore != null">
                performance_score,
            </if>
            <if test="workScore != null">
                work_score,
            </if>
            <if test="completed != null">
                completed,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="userId != null">
                #{userId,jdbcType=INTEGER},
            </if>
            <if test="courseId != null">
                #{courseId,jdbcType=INTEGER},
            </if>
            <if test="examScore != null">
                #{examScore,jdbcType=REAL},
            </if>
            <if test="performanceScore != null">
                #{performanceScore,jdbcType=REAL},
            </if>
            <if test="workScore != null">
                #{workScore,jdbcType=REAL},
            </if>
            <if test="completed != null">
                #{completed,jdbcType=INTEGER},
            </if>
        </trim>
    </insert>
    <update id="updateByPrimaryKeySelective" parameterType="com.project.demo.DO.ElectiveDO">
        update elective
        <set>
            <if test="examScore != null">
                exam_score = #{examScore,jdbcType=REAL},
            </if>
            <if test="performanceScore != null">
                performance_score = #{performanceScore,jdbcType=REAL},
            </if>
            <if test="workScore != null">
                work_score = #{workScore,jdbcType=REAL},
            </if>
            <if test="completed != null">
                completed = #{completed,jdbcType=INTEGER},
            </if>
        </set>
        where user_id = #{userId,jdbcType=INTEGER}
        and course_id = #{courseId,jdbcType=INTEGER}
    </update>
    <update id="updateByPrimaryKey" parameterType="com.project.demo.DO.ElectiveDO">
    update elective
    set exam_score = #{examScore,jdbcType=REAL},
      performance_score = #{performanceScore,jdbcType=REAL},
      work_score = #{workScore,jdbcType=REAL},
      completed = #{completed,jdbcType=INTEGER}
    where user_id = #{userId,jdbcType=INTEGER}
      and course_id = #{courseId,jdbcType=INTEGER}
  </update>


    <select id="getElectiveList" parameterType="java.lang.Integer" resultType="com.project.demo.VO.ElectiveVO">
        select
        u.user_id,u.nick_name,CONVERT(e.completed/c.schedule,DECIMAL(10,2)) as progress,performance_score,e.course_id,work_score,exam_score
        from elective e inner join course c
        on e.course_id=c.course_id
        inner join user u
        on e.user_id = u.user_id
        where e.course_id=#{courseId,jdbcType=INTEGER}
    </select>
    <update id="courseGrading">
        update elective e right join course c
        on e.course_id=e.course_id
        set
        e.exam_score=#{examScore,jdbcType=FLOAT},
        e.performance_score=#{performanceScore,jdbcType=FLOAT}
        where e.user_id=#{stuId,jdbcType=INTEGER}
        and c.author_id=#{teacherId,jdbcType=INTEGER}
    </update>
    <select id="getCourseScore" resultType="com.project.demo.VO.ScoreVO">
        select e.exam_score,e.performance_score,e.work_score
        from elective e
        where e.user_id=#{userId,jdbcType=INTEGER} and e.course_id=#{courseId,jdbcType=INTEGER}
    </select>
    <insert id="joinCourse">
        insert into elective(user_id, course_id)
        values(#{userId,jdbcType=INTEGER},#{courseId,jdbcType=INTEGER})
    </insert>
</mapper>